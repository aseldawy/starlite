<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>POINTLM Viewer</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<link href="https://unpkg.com/maplibre-gl@3.6.0/dist/maplibre-gl.css" rel="stylesheet" />
<script src="https://unpkg.com/maplibre-gl@3.6.0/dist/maplibre-gl.js"></script>

<style>
  body { margin: 0; padding: 0; }
  #map { width: 100vw; height: 100vh; }
</style>
</head>

<body>
<div id="map"></div>

<script>
// ---------------------------
// Map initialization
// ---------------------------
const map = new maplibregl.Map({
  container: "map",
  style: {
    version: 8,
    sources: {
      basemap: {
        type: "raster",
        tiles: ["https://tile.openstreetmap.org/{z}/{x}/{y}.png"],
        tileSize: 256
      },
      local: {
        type: "vector",
        tiles: ["http://127.0.0.1:5000/TIGER2018_POINTLM/{z}/{x}/{y}.mvt"],
        minzoom: 0,
        maxzoom: 14
      }
    },
    layers: [
      {
        id: "basemap",
        type: "raster",
        source: "basemap"
      },

      // -------------------------
      // POINTLM point styling
      // -------------------------
      {
        id: "pointlm-points",
        type: "circle",
        source: "local",
        "source-layer": "layer0",
        paint: {
          // Point radius grows with zoom
          "circle-radius": [
            "interpolate",
            ["linear"],
            ["zoom"],
            4, 2,
            8, 4,
            12, 7,
            14, 10
          ],

          // Color based on MTFCC category
          "circle-color": [
            "match",
            ["get", "MTFCC"],
            "K2540", "#ff7f0e",   // Schools
            "K2543", "#1f77b4",   // Hospitals
            "K2450", "#2ca02c",   // Airports
            "K1231", "#d62728",   // Summits
            "K3340", "#9467bd",   // Parks
            "K2380", "#8c564b",   // Cemeteries
            "#aaaaaa"             // fallback
          ],

          "circle-opacity": 0.85,
          "circle-stroke-width": 1,
          "circle-stroke-color": "#000000"
        }
      }
    ]
  },
  center: [-98, 38],
  zoom: 4
});

map.addControl(new maplibregl.NavigationControl());

// ---------------------------
// Popup for labels
// ---------------------------
const popup = new maplibregl.Popup({
  closeButton: false,
  closeOnClick: false
});

// Show popup on hover
map.on("mousemove", "pointlm-points", (e) => {
  const feature = e.features[0];
  const name = feature.properties.FULLNAME || "(Unnamed landmark)";
  const mtfcc = feature.properties.MTFCC || "(no code)";

  map.getCanvas().style.cursor = "pointer";

  popup
    .setLngLat(e.lngLat)
    .setHTML(`
      <b>${name}</b><br>
      <span>MTFCC: ${mtfcc}</span>
    `)
    .addTo(map);
});

// Hide popup when mouse leaves point layer
map.on("mouseleave", "pointlm-points", () => {
  map.getCanvas().style.cursor = "";
  popup.remove();
});

</script>
</body>
</html>
