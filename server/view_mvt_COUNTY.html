<!-- <!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Local MVT Viewer Points, Lines, Polygons</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="https://unpkg.com/maplibre-gl@3.6.0/dist/maplibre-gl.css" rel="stylesheet" />
<script src="https://unpkg.com/maplibre-gl@3.6.0/dist/maplibre-gl.js"></script>
<style>
  body { margin: 0; padding: 0; }
  #map { width: 100vw; height: 100vh; }
</style>
</head>
<body>

<div id="map"></div>

<script>
// Log all network requests made by fetch
const origFetch = window.fetch;
window.fetch = async function(...args) {
  console.log("[Fetch] Request", args[0]);
  try {
    const resp = await origFetch(...args);
    console.log("[Fetch] Response", args[0], resp.status, resp.headers.get("Content-Type"));
    return resp;
  } catch (err) {
    console.error("[Fetch] ERROR", args[0], err);
    throw err;
  }
};

// Create the map
const map = new maplibregl.Map({
  container: "map",
  style: {
    version: 8,
    sources: {
      basemap: {
        type: "raster",
        tiles: ["https://tile.openstreetmap.org/{z}/{x}/{y}.png"],
        tileSize: 256
      },
      local: {
        type: "vector",
        // tiles: ["http://127.0.0.1:5000/OSM2015_33/{z}/{x}/{y}.mvt"],
        // tiles: ["http://127.0.0.1:5000/out_ca/{z}/{x}/{y}.mvt"],
        //  tiles: ["http://127.0.0.1:5000/TIGER2018_COUNTY/{z}/{x}/{y}.mvt"],
        tiles: ["http://127.0.0.1:5000/TIGER2018_PLACE/{z}/{x}/{y}.mvt"],
        // tiles: ["http://127.0.0.1:5000/roads/{z}/{x}/{y}.mvt"],

        minzoom: 0,
        maxzoom: 14
      }
    },
    layers: [
      {
        id: "basemap",
        type: "raster",
        source: "basemap"
      },
      // {
      //   id: "layer0-fill",
      //   type: "fill",
      //   source: "local",
      //   "source-layer": "layer0",
      //   paint: {
      //     "fill-color": "#0080ff",
      //     "fill-opacity": 0.25
      //   }
      // },
      {
        id: "layer0-outline",
        type: "line",
        source: "local",
        "source-layer": "layer0",
        paint: {
          "line-color": "#003366",
          "line-width": 1.5,
          "line-opacity": 0.9
        }
      },
      {
        id: "layer0-lines",
        type: "line",
        source: "local",
        "source-layer": "layer0",
        paint: {
          "line-color": "#ff6600",
          "line-width": 2.0,
          "line-opacity": 0.9
        },
        filter: ["==", "$type", "LineString"]
      },
      {
        id: "layer0-points",
        type: "circle",
        source: "local",
        "source-layer": "layer0",
        paint: {
          "circle-radius": 4,
          "circle-color": "#ff0000",
          "circle-stroke-width": 1,
          "circle-stroke-color": "#ffffff",
          "circle-opacity": 0.9
        },
        filter: ["==", "$type", "Point"]
      }
    ]
  },
  center: [-120, 37],
  zoom: 5
});

map.addControl(new maplibregl.NavigationControl());

// Log all map data events
map.on("data", e => {
  if (e.sourceId === "local") {
    console.log("[Maplibre data]", e);
  }
});

// Log detailed tile events
map.on("sourcedata", e => {
  if (e.sourceId === "local") {
    console.log("[Tile event] state", e.tile && e.tile.state, "coord", e.tile && e.tile.coord, e);
  }
});

// Log map errors
map.on("error", e => {
  console.error("[Maplibre error]", e);
});

// Log loading events
map.on("dataloading", e => {
  if (e.sourceId === "local") {
    console.log("[Loading tile]", e);
  }
});

</script>
</body>
</html> -->




<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Local MVT Viewer Points, Lines, Polygons</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="https://unpkg.com/maplibre-gl@3.6.0/dist/maplibre-gl.css" rel="stylesheet" />
<script src="https://unpkg.com/maplibre-gl@3.6.0/dist/maplibre-gl.js"></script>
<style>
  body { margin: 0; padding: 0; }
  #map { width: 100vw; height: 100vh; }
</style>
</head>
<body>

<div id="map"></div>

<script>
// Intercept fetch to log tile loading
const origFetch = window.fetch;
window.fetch = async function(...args) {
  console.log("[Fetch] Request", args[0]);
  try {
    const resp = await origFetch(...args);
    console.log("[Fetch] Response", args[0], resp.status, resp.headers.get("Content-Type"));
    return resp;
  } catch (err) {
    console.error("[Fetch] ERROR", args[0], err);
    throw err;
  }
};

// Create the map
const map = new maplibregl.Map({
  container: "map",
  style: {
    version: 8,
    sources: {
      basemap: {
        type: "raster",
        tiles: ["https://tile.openstreetmap.org/{z}/{x}/{y}.png"],
        tileSize: 256
      },
      local: {
        type: "vector",
        // tiles: ["http://127.0.0.1:5000/TIGER2018_PLACE/{z}/{x}/{y}.mvt"],
          tiles: ["http://127.0.0.1:5000/TIGER2018_COUNTY/{z}/{x}/{y}.mvt"],

        minzoom: 0,
        maxzoom: 14
      }
    },
    layers: [
      {
        id: "basemap",
        type: "raster",
        source: "basemap"
      },

      /* -----------------------
         POLYGON FILL BY STATEFP
         ----------------------- */
      // {
      //   id: "place-fill",
      //   type: "fill",
      //   source: "local",
      //   "source-layer": "layer0",
      //   filter: ["==", "$type", "Polygon"],
      //   paint: {
      //     "fill-color": [
      //       "interpolate",
      //       ["linear"],
      //       ["to-number", ["get", "STATEFP"]],
      //       1,  "#440154",
      //       10, "#31678f",
      //       20, "#21918c",
      //       30, "#5ec962",
      //       40, "#fde725",
      //       56, "#ffffcc"
      //     ],
      //     "fill-opacity": 0.65
      //   }
      // },


{
  id: "place-fill",
  type: "fill",
  source: "local",
  "source-layer": "layer0",
  filter: ["==", "$type", "Polygon"],
  paint: {
    "fill-color": [
      "match",
      ["get", "STATEFP"],
      "01", "#a6cee3",  // AL
      "02", "#1f78b4",  // AK
      "04", "#b2df8a",  // AZ
      "05", "#33a02c",  // AR
      "06", "#fb9a99",  // CA
      "08", "#e31a1c",  // CO
      "09", "#fdbf6f",  // CT
      "10", "#ff7f00",  // DE
      "11", "#cab2d6",  // DC
      "12", "#6a3d9a",  // FL
      "13", "#ffff99",  // GA
      "15", "#b15928",  // HI
      "16", "#8dd3c7",  // ID
      "17", "#ffffb3",  // IL
      "18", "#bebada",  // IN
      "19", "#fb8072",  // IA
      "20", "#80b1d3",  // KS
      "21", "#fdb462",  // KY
      "22", "#b3de69",  // LA
      "23", "#fccde5",  // ME
      "24", "#d9d9d9",  // MD
      "25", "#bc80bd",  // MA
      "26", "#ccebc5",  // MI
      "27", "#ffed6f",  // MN
      "28", "#1b9e77",  // MS
      "29", "#d95f02",  // MO
      "30", "#7570b3",  // MT
      "31", "#e7298a",  // NE
      "32", "#66a61e",  // NV
      "33", "#e6ab02",  // NH
      "34", "#a6761d",  // NJ
      "35", "#666666",  // NM
      "36", "#8dd3c7",  // NY
      "37", "#ffffb3",  // NC
      "38", "#bebada",  // ND
      "39", "#fb8072",  // OH
      "40", "#80b1d3",  // OK
      "41", "#fdb462",  // OR
      "42", "#b3de69",  // PA
      "44", "#fccde5",  // RI
      "45", "#d9d9d9",  // SC
      "46", "#bc80bd",  // SD
      "47", "#ccebc5",  // TN
      "48", "#ffed6f",  // TX
      "49", "#1b9e77",  // UT
      "50", "#d95f02",  // VT
      "51", "#7570b3",  // VA
      "53", "#e7298a",  // WA
      "54", "#66a61e",  // WV
      "55", "#e6ab02",  // WI
      "56", "#a6761d",  // WY
      /* default */ "#cccccc"
    ],
    "fill-opacity": 0.65
  }
},
      /* -----------------------
         POLYGON OUTLINE
         ----------------------- */
      {
        id: "place-outline",
        type: "line",
        source: "local",
        "source-layer": "layer0",
        filter: ["==", "$type", "Polygon"],
        paint: {
          "line-color": "#003366",
          "line-width": 1.3,
          "line-opacity": 0.9
        }
      },

      /* -----------------------
         LINESTRINGS
         ----------------------- */
      {
        id: "layer0-lines",
        type: "line",
        source: "local",
        "source-layer": "layer0",
        filter: ["==", "$type", "LineString"],
        paint: {
          "line-color": "#ff6600",
          "line-width": 2.0,
          "line-opacity": 0.9
        }
      },

      /* -----------------------
         POINTS
         ----------------------- */
      {
        id: "layer0-points",
        type: "circle",
        source: "local",
        "source-layer": "layer0",
        filter: ["==", "$type", "Point"],
        paint: {
          "circle-radius": 4,
          "circle-color": "#ff0000",
          "circle-stroke-width": 1,
          "circle-stroke-color": "#ffffff",
          "circle-opacity": 0.9
        }
      }
    ]
  },
  center: [-120, 37],
  zoom: 5
});

map.addControl(new maplibregl.NavigationControl());

// Debug logs
map.on("data", e => {
  if (e.sourceId === "local") console.log("[Maplibre data]", e);
});

map.on("sourcedata", e => {
  if (e.sourceId === "local") {
    console.log("[Tile event] state", e.tile && e.tile.state, 
                "coord", e.tile && e.tile.coord, e);
  }
});

map.on("error", e => console.error("[Maplibre error]", e));

map.on("dataloading", e => {
  if (e.sourceId === "local") console.log("[Loading tile]", e);
});
</script>

</body>
</html>
